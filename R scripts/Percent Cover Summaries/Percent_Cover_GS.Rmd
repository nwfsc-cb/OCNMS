---
title: "Percent Cover"
output:
  html_document: default
  pdf_document: default
---
 
```{r setup, include=FALSE, message=FALSE, warning=FALSE}
#to load data make sure directory is set to knit from project directory
knitr::opts_chunk$set(echo = FALSE,message=FALSE, warning=FALSE)
 
library(here)
library(tidyverse)
library(knitr)
 
substrate_codes <- read_csv(here("Data","CSV_2015_on","substrate_codes.csv"))

#load 2015 data 
dat.2015 <- read_csv(here("Data", "csv files", "2015_OCNMSDataComplete_standardized_122116.csv")) %>%
  filter(`PISCO datatype` == "UPC") %>%
  separate(Date, into = c("MONTH","DAY","YEAR")) %>%
  rename_all(toupper) %>%
  rename(CLASSCODE= "PISCO CLASSCODE") %>%
  mutate(BUDDY = NA, SEGMENT = NA,SIDE = NA, ZONE = NA, TRANSECT = NA) %>%
  select(SITE, MONTH, DAY, YEAR, OBSERVER, TRANSECT ,QUADRAT, CLASSCODE, PERCENT.COVER,COUNT,DEPTH.FT,SIDE,ZONE,TRANSECT,BUDDY,SEGMENT)
 
#2016 --> 2019
dat.2016 <- read_csv(here("Data","CSV_2015_on","NWFSC_UPC_ALLYEARS_data_2019.csv")) %>% 
              filter(CATEGORY == "COVER") %>%
              select(1:20) %>%
              rename(DEPTH.FT= "DEPTH (FT)")  %>%
              mutate(QUADRAT = NA, PERCENT.COVER = NA) %>% #will circle back tothis and get % cover for 2016 to 2019 data 
              select(SITE, MONTH, DAY, YEAR, OBSERVER, TRANSECT ,QUADRAT, CLASSCODE, PERCENT.COVER,COUNT,DEPTH.FT,SIDE,ZONE,TRANSECT,BUDDY,SEGMENT)

dat.upc <- rbind(dat.2015, dat.2016) %>%
 mutate(COUNT = replace_na(COUNT, 0)) %>%
  left_join(substrate_codes) %>% #rename two that arent in substrate key
  mutate(NAME = case_when(CLASSCODE == "ptero" | NAME == "Pterogophora" ~ "Pterygophora",
                          CLASSCODE == "shell" ~ "various bivalves",
                          TRUE ~ NAME),
#ASSIGN FUNCTIONAL GROUPS 
         Functional_Group = case_when(
                                    NAME %in% c("Red algae (branching flat blade)", "Red algae (cylindrical branches)", "Red algae (lacy branching)","Red algae -Encrusting", "Coralline algae -Crustose", "Red algae (leaf-like)","articulated coralline") ~ "Red Algae",
                                    NAME %in% c("Nereocystis holdfast (alive)", "Macrosystis holdfast (alive)", "Laminariales holdfast (alive)") ~"Holdfast", 
                                    NAME %in% c("Pterygophora", "Brown algae understory prone") ~ "Brown Algae (Understory)",
                                    NAME %in% c("urchin", "Cucumaria spp.' sea cucumber") ~ "Echinoderm", 
                                    NAME %in% c("various bivalves", "Scallop") ~ "Bivalve",
                                    NAME %in% c("Anemone", "Cup Coral") ~ "Anthozoa",
                                    NAME %in% c("Substrate: Bedrock","Shell Debris","Bare Sand", "Substrate: Cobble","Sediment/Mud", "Substrate: Sand","Bare Rock" ) ~ "Non-living Substrate",
                                    NAME %in% c("Tunicate -Colonial,compund,social","Tunicate -Solitary") ~"Tunicate",
                                    NAME %in% c("Zostera marina, eelgrass" , "Phyllospadix spp.' surfgrass") ~ "Eelgrass_Surfgrass",
                                    NAME %in% c("Encrusting hydrocoral (eg. Stylantheca)", "Hydroid" ) ~ "Misc Invert",
                                    TRUE ~ NAME),
 #ASSIGN ORGANISM GROUPS         
        Organism_Group = case_when(NAME %in% c("Red algae (branching flat blade)", "Red algae (cylindrical branches", "Red algae (lacy branching)","Pterygophora", "Brown algae understory prone","Red algae -Encrusting", "Coralline algae -Crustose","Nereocystis holdfast (alive)","Macrosystis holdfast (alive)","Phyllospadix spp.' surfgrass", "Zostera marina, eelgrass","Encrusting hydrocoral (eg. Stylantheca)","Green algae","Laminariales holdfast (alive)","articulated coralline", "Red algae (cylindrical branches)","Red algae (leaf-like)") ~ "Plant_Algae",
                                    NAME %in% c("various bivalves", "Scallop","Anemone", "Cup Coral","Barnacle","Tunicate -Colonial,compund,social", "Tunicate -Solitary","urchin","Bryozoan","Diatom Layer","Sponge","Tubeworm","Hydroid", "Cucumaria spp.' sea cucumber") ~ "Invertebrate",
                                    NAME %in% c("Substrate: Bedrock","Shell Debris","Bare Sand", "Substrate: Cobble","Sediment/Mud", "Substrate: Sand","Bare Rock" ) ~ "Non-living Substrate", 
                                    TRUE ~ NAME))  


rm(dat.2016,dat.2015) 


unique(dat.upc$Functional_Group)
```

## Lump Original Categories

```{r , echo=FALSE}
summary_table<- dat.upc %>%
  group_by(Organism_Group,Functional_Group, NAME) %>%
  summarise(species_occurence = sum(COUNT))  
 
kable(summary_table)
```

```{r }
dat.upc %>%
  group_by(NAME) %>%
  summarise(species_occurence = sum(COUNT)) %>%
  ggplot() +
  geom_bar(aes(x=reorder(NAME, -species_occurence), y = species_occurence), stat = "identity")+ 
  theme_classic() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  xlab("Original Species Groups") +
  ylab("Species Count")
```

 
```{r}
dat.upc %>%
  group_by(Functional_Group) %>%
  summarise(species_occurence = sum(COUNT)) %>%
  ggplot() +
  geom_bar(aes(x=reorder(Functional_Group, -species_occurence), y = species_occurence), stat = "identity")+ 
  theme_classic() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  xlab("Functional Groups") +
  ylab("Species Count")
```

 
```{r}
dat.upc %>%
  group_by(Organism_Group) %>%
  summarise(species_occurence = sum(COUNT)) %>%
  ggplot() +
  geom_bar(aes(x=reorder(Organism_Group, -species_occurence), y = species_occurence), stat = "identity")+ 
  theme_classic() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  xlab("Organism Groups") +
  ylab("Species Count")
```

 
