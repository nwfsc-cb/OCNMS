<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nick Tolimieri &amp; Ole Shelton">
<meta name="dcterms.date" content="2025-02-04">

<title>YOY analysis: Black and yellowtail rockfish complex</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="_01_OCNMS-rockfish-YOY-analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="_01_OCNMS-rockfish-YOY-analysis_files/libs/quarto-html/quarto.js"></script>
<script src="_01_OCNMS-rockfish-YOY-analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="_01_OCNMS-rockfish-YOY-analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="_01_OCNMS-rockfish-YOY-analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="_01_OCNMS-rockfish-YOY-analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="_01_OCNMS-rockfish-YOY-analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="_01_OCNMS-rockfish-YOY-analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="_01_OCNMS-rockfish-YOY-analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="_01_OCNMS-rockfish-YOY-analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">YOY analysis: Black and yellowtail rockfish complex</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nick Tolimieri &amp; Ole Shelton </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 4, 2025</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="data-description" class="level1">
<h1>Data description</h1>
<p>These are derived data products relevant to estimating recruitment of the black rockfish and yellowtail rockfish comlex stemming from NWFSC dive surveys in the Olympic Coast National Marine Sanctuary (OCNMS) conducted between 2015 and 2024. We estimate recruitment (young-of-year abundance) for the complex because it is difficult to distinguish small recruits for these species. Description of survey methods and aims are detailed in <span class="citation" data-cites="tolimieri2023changes">(<a href="#ref-tolimieri2023changes" role="doc-biblioref">Tolimieri et al. 2023</a>)</span> We provide a brief summary of methods relevant to fish surveys here.</p>
<p>Divers on SCUBA conducted in situ surveys to count fish at each site along benthic belt transects (30 m by 2 m) following slightly modified procedures described in <span class="citation" data-cites="malone2022large">Malone et al. (<a href="#ref-malone2022large" role="doc-biblioref">2022</a>)</span>. Transects were conducted within or directly adjacent to canopy kelp beds (consisting of giant <em>Macrocystis pyrifera</em> or bull <em>Nereocystis luetkeana</em> kelps). From 2016 on, we surveyed at five (5) sites (<a href="#fig-site-map">Fig.&nbsp;1</a>), sampling at two (2) locations within each site separated by &gt;100 m, and 2 depths within each location (5 and 10 m) Our goal was to complete six (6) replicate transects at each year-site-depth combination. In 2015 surveyed at 10 sites and conducted four (4) transects per site at 5 m depth (<a href="#fig-site-map">Fig.&nbsp;1</a>).</p>
<p>During each fish transect, we counted and estimated the size (total length to nearest cm) of all fishes &gt;5 cm total length; the exception was rockfishes <em>Sebastes</em> spp., for which we estimated sizes of all individuals. Rockfishes <span class="math inline">\(\leq\)</span> 10 cm were considered young of year. Divers also estimated horizontal visibility on each transect by determining the distance at which the lead diver could distinguish their buddy’s extended fingers. Transects with visibility less than 2 m were excluded from analyses.</p>
<p>As noted above, it is difficult to visually distinguish many rockfish species when they are small. Therefore, on our surveys, we categorized juvenile rockfishes into five (5) groups established in the literature <span class="citation" data-cites="johansson2018seasonal markel2020contrasting">(<a href="#ref-johansson2018seasonal" role="doc-biblioref">Johansson et al. 2018</a>; <a href="#ref-markel2020contrasting" role="doc-biblioref">Markel and Shurin 2020</a>)</span>:</p>
<p>(1) Yellowtail and black (YTB) included both yellowtail (<em>S. flavidus</em>) and black (<em>S. melanops</em>) rockfishes.</p>
<p>(2) The copper/quillback/brown (CQB) group included copper (<em>S. caurinus</em>), quillback (<em>S. maliger</em>), and brown (<em>S. auriculatus</em>) rockfishes.</p>
<p>(3) Canary (<em>S. pinniger</em>) and</p>
<p>(4) Blue rockfish (<em>S. mystinus</em>) to species.</p>
<p>(5) Unidentified individuals were categorized as juvenile rockfishes.</p>
<p>The estimated recruitment trend for (1), the black rockfish and yellowtail rockfish complex, is presented here.</p>
<div class="cell" data-messange="false">
<div class="cell-output-display">
<div id="fig-site-map" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="_01_OCNMS-rockfish-YOY-analysis_files/figure-html/fig-site-map-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Dive survey locations along the coast of Washington state.</figcaption>
</figure>
</div>
</div>
</div>
<p>As a result of our 2-m visibility requirements, some transects were omitted from the analyses. The following tables (<a href="#tbl-2m-samples-YS">Table&nbsp;2</a>) show how the number fish transects with visibility &gt;2 m were distributed across depth, site, and years (<a href="#tbl-2m-samples-YSD">Table&nbsp;1</a>), as well as across sites and year (<a href="#tbl-2m-samples-YS">Table&nbsp;2</a>). 2015 includes only surveys conducted at 5-m depth; other years have data approximately evenly split between 5-m and 10-m depths.</p>
<div class="cell" data-messange="false">
<div class="cell-output-display">
<div id="tbl-2m-samples-YSD" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;1: Number of transects conducted by year, site and depth zone. Only transects that had at least 2m visibility are included</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 22%">
<col style="width: 15%">
<col style="width: 13%">
<col style="width: 18%">
<col style="width: 10%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Year</th>
<th style="text-align: right;">Zone</th>
<th style="text-align: right;">Destruction Island</th>
<th style="text-align: right;">Cape Johnson</th>
<th style="text-align: right;">Cape Alava</th>
<th style="text-align: right;">Tatoosh Island</th>
<th style="text-align: right;">Neah Bay</th>
<th style="text-align: right;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2016</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="even">
<td style="text-align: right;">2016</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2017</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">19</td>
</tr>
<tr class="even">
<td style="text-align: right;">2017</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2018</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="even">
<td style="text-align: right;">2018</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2019</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">31</td>
</tr>
<tr class="even">
<td style="text-align: right;">2019</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">37</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2021</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="even">
<td style="text-align: right;">2021</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">32</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">40</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">36</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2024</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="even">
<td style="text-align: right;">2024</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">24</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="cell" data-messange="false">
<div class="cell-output-display">
<div id="tbl-2m-samples-YS" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;2: Number of transects conducted by year and site. Only transects that had at least 2-m visibility are included</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Site</th>
<th style="text-align: right;">2016</th>
<th style="text-align: right;">2017</th>
<th style="text-align: right;">2018</th>
<th style="text-align: right;">2019</th>
<th style="text-align: right;">2021</th>
<th style="text-align: right;">2022</th>
<th style="text-align: right;">2023</th>
<th style="text-align: right;">2024</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Destruction Island</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cape Johnson</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Cape Alava</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tatoosh Island</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Neah Bay</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="even">
<td style="text-align: left;">TOTAL</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">36</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="recruitment-young-of-year-abundance-trends" class="level2">
<h2 class="anchored" data-anchor-id="recruitment-young-of-year-abundance-trends">Recruitment: Young-of-year abundance trends</h2>
<p>To calculate the average density of black/yellowtail rockfish complex in each year, we first calculate the mean density and standard error per site in each year. This approach means we are treating each transect as a i.i.d. sample of YOY density within each site and thus we ignore differences in abundance by depth zone.</p>
<p>From these site-year level means, we calculated a year-specific mean density by simulation. Specifically, for each year we independently drew a mean density for each site using a t-distribution with <span class="math inline">\(\mu\)</span> (the estimated site mean), <span class="math inline">\(\sigma\)</span> (the estimated site-specific standard error) and degrees of freedom, <span class="math inline">\(\tau\)</span>. So for the <span class="math inline">\(i^{th}\)</span> realization, for site <span class="math inline">\(s\)</span> in year <span class="math inline">\(y\)</span> we have a predicted density, <span class="math inline">\(X_{isy}\)</span></p>
<span class="math display">\[\begin{align}  &amp; X_{isy} \sim T(\mu_{sy},\sigma_{sy},\tau_{sy}) \\ \end{align}\]</span>
<p>and then the predicted density for a single realization in a given year is the mean among sites observed. We repeat the simulation 100,000 times to provide an estimated mean density and uncertainty for a given year (<a href="#fig-yoy-ts">Fig.&nbsp;2</a>).</p>
<p>Nearly all small rockfish fall into the 4 to 7 cm length range and all are considered to have recruited from the plankton during the calender year of the survey. Therefore, we view the density of &lt;10cm rockfish to be an indicator of recruitment for the black/yellowtail rockfish complex (<a href="#fig-yoy-ts">Fig.&nbsp;2</a>).</p>
<div class="cell" data-messange="false">
<div class="cell-output-display">
<div id="fig-yoy-ts" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="_01_OCNMS-rockfish-YOY-analysis_files/figure-html/fig-yoy-ts-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Time-series of estimated young-of-year rockfish (black-yellowtail complex) density on the Washington coast. Black points show means and standard errors for individual sites. Blue points show coastwide density estimates, interquartile range and 95% intervals for each year. Note y-axis is square root.</figcaption>
</figure>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
</section>
<section id="references" class="level2 unnumbered">


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-johansson2018seasonal" class="csl-entry" role="listitem">
Johansson, Mattias L, Marisa NC Litz, Richard D Brodeur, Tristan A Britt, Camilo A Vanegas, John R Hyde, and Michael A Banks. 2018. <span>“<span class="nocase">Seasonal distribution of late larval and juvenile rockfish (<em>Sebastes</em> spp.) and associated environmental conditions off Oregon and Washington: new insights based on genetics</span>.”</span> <em>Fishery Bulletin</em>, no. 3-4: 266–91.
</div>
<div id="ref-malone2022large" class="csl-entry" role="listitem">
Malone, Daniel P, Kathryn Davis, Steve I Lonhart, Avrey Parsons-Field, Jennifer E Caselle, and Mark H Carr. 2022. <span>“<span class="nocase">Large-scale, multidecade monitoring data from kelp forest ecosystems in California and Oregon (USA)</span>.”</span> Wiley Online Library.
</div>
<div id="ref-markel2020contrasting" class="csl-entry" role="listitem">
Markel, Russell W, and Jonathan B Shurin. 2020. <span>“<span class="nocase">Contrasting effects of coastal upwelling on growth and recruitment of nearshore Pacific rockfishes (genus <em>Sebastes</em>)</span>.”</span> <em>Canadian Journal of Fisheries and Aquatic Sciences</em> 77 (6): 950–62.
</div>
<div id="ref-tolimieri2023changes" class="csl-entry" role="listitem">
Tolimieri, Nick, Andrew O Shelton, Jameal F Samhouri, Chris J Harvey, Blake E Feist, Gregory D Williams, Kelly S Andrews, et al. 2023. <span>“<span class="nocase">Changes in kelp forest communities off Washington, USA, during and after the 2014-2016 marine heatwave and sea star wasting syndrome</span>.”</span> <em>Marine Ecology Progress Series</em> 703: 47–66.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>